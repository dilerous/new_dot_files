function isMac(){return-1!==navigator.userAgent.indexOf("Mac OS X")}function shortcutDecorator(a){return a?(a=a.toLowerCase(),a=isMac()?a.replace("shift","⇧"):a,a=isMac()?a.replace("alt","⌥"):a,a=isMac()?a.replace("ctrl","⌃"):a,a=isMac()?a.replace("meta","⌘"):a):""}function filterShortcutInput(a){var b=0,c=0;if(-1!==a.indexOf("enter"))return"";a=a.toLowerCase(),b+=-1!==a.indexOf("shift")?1:0,b+=-1!==a.indexOf("ctrl")?1:0,b+=-1!==a.indexOf("alt")?1:0,b+=-1!==a.indexOf("meta")?1:0;var d=a.split("+").length;return c=d-b,d===b||0===b?(setError(),""):c>1?(setError(),""):a}function setError(){document.getElementById("shortcut_error").style.display="block",setTimeout(function(){document.getElementById("shortcut_error").style.display="none"},2e3)}function modifyShortcutKey(a){return a=a.toLowerCase(),-1!==navigator.appVersion.indexOf("Mac")?-1!==a.indexOf("ctrl")&&-1===a.indexOf("meta")&&(a=a.replace("ctrl","meta")):-1!==a.indexOf("meta")&&-1===a.indexOf("ctrl")&&(a=a.replace("meta","ctrl")),-1!==a.indexOf("pgup")&&(a=a.replace("pgup","pageup")),-1!==a.indexOf("pgdown")&&(a=a.replace("pgdown","pagedown")),a}function reorderKeys(a){for(var b=a.split("+"),c=[],d=[],e=0,f=b.length;e<f;e++){var g=b[e];"meta"!==g&&"alt"!==g&&"ctrl"!==g&&"shift"!==g?d.push(g):c.push(g)}return c.concat(d).join("+")}var shortcutInput=document.getElementById("shortcut_input"),default_shortcut=isMac()?"meta+/":"ctrl+/",old_shortcut="";document.addEventListener("DOMContentLoaded",function(a){chrome.storage.local.get("enpass_shortcut",function(a){chrome.storage.local.get("enpass_shortcut_override",function(b){a.enpass_shortcut&&(old_shortcut=b.enpass_shortcut_override?a.enpass_shortcut:modifyShortcutKey(a.enpass_shortcut),shortcutInput.value=shortcutDecorator(old_shortcut))})})}),shortcutInput.addEventListener("focus",function(a){var b=a.target;b.value="",document.getElementById("shortcut_error").style.display="none",document.getElementById("shortcut_info").style.display="block",Mousetrap.record(function(a){var c=filterShortcutInput(a[a.length-1]);if(c){c=reorderKeys(c);var d=shortcutDecorator(c);b.value=d,old_shortcut=d,chrome.storage.local.set({enpass_shortcut_override:!0,enpass_shortcut:c}),chrome.runtime.sendMessage({header:"newShortcut",shortcut:c})}b.blur()})}),shortcutInput.addEventListener("blur",function(a){document.getElementById("shortcut_info").style.display="none",shortcutInput.vaule||(shortcutInput.value=shortcutDecorator(old_shortcut))}),document.getElementById("reset_btn").addEventListener("click",function(a){shortcutInput.value="",old_shortcut="",chrome.storage.local.set({enpass_shortcut_override:!0,enpass_shortcut:old_shortcut}),chrome.runtime.sendMessage({header:"newShortcut",shortcut:""})}),document.getElementById("default_btn").addEventListener("click",function(a){shortcutInput.value=shortcutDecorator(default_shortcut),old_shortcut=default_shortcut,chrome.storage.local.set({enpass_shortcut_override:!0,enpass_shortcut:old_shortcut}),chrome.runtime.sendMessage({header:"newShortcut",shortcut:default_shortcut})});